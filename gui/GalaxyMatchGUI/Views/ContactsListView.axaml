<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:GalaxyMatchGUI.ViewModels"
             xmlns:models="using:GalaxyMatchGUI.Models"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignWidth="400"
             d:DesignHeight="600"
             x:Class="GalaxyMatchGUI.Views.ContactsListView"
             x:DataType="vm:ContactsListViewModel">

    <Grid RowDefinitions="Auto,*" Background="#0D0221" Margin="20">
        
        <!-- Top content -->
        <StackPanel Spacing="20" Grid.Row="0">
            <!-- Header -->
            <Border CornerRadius="10" Background="#1E0B45" Padding="15">
                <TextBlock Text="Cosmic Connections" 
                           FontSize="24"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           Foreground="#00FF9F"
                           TextAlignment="Center"/>
            </Border>

            <!-- Refresh Button -->
            <Button Content="⟳ Refresh Connections"
                    Command="{Binding RefreshContactsCommand}"
                    IsEnabled="{Binding !IsLoading}"
                    HorizontalAlignment="Center"
                    Padding="20,8"
                    Margin="0,0,0,10"
                    MinWidth="180"
                    FontSize="14"
                    Cursor="Hand">
                <Button.Styles>
                    <Style Selector="Button">
                        <Setter Property="Background" Value="#7B2CBF"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="CornerRadius" Value="25"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Effect">
                            <DropShadowEffect BlurRadius="8" Color="#9D4EDD" Opacity="0.6"/>
                        </Setter>
                        <Setter Property="Cursor" Value="Hand"/>
                    </Style>
                    <Style Selector="Button:pointerover">
                        <Setter Property="Background" Value="#9D4EDD"/>
                        <Setter Property="Effect">
                            <DropShadowEffect BlurRadius="12" Color="#9D4EDD" Opacity="0.8"/>
                        </Setter>
                    </Style>
                    <Style Selector="Button:disabled">
                        <Setter Property="Opacity" Value="0.6"/>
                        <Setter Property="Cursor" Value="Arrow"/>
                    </Style>
                </Button.Styles>
            </Button>

            <!-- Status Message -->
            <Border CornerRadius="5" Background="#1E0B45" Padding="10" 
                    Margin="0,0,0,10"
                    IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                <TextBlock Text="{Binding StatusMessage}"
                           HorizontalAlignment="Center"
                           Foreground="#9F9FFF"
                           FontStyle="Italic"
                           TextWrapping="Wrap"/>
            </Border>

            <!-- Loading Bar -->
            <ProgressBar IsIndeterminate="True"
                         IsVisible="{Binding IsLoading}"
                         Height="4"
                         Foreground="#00FF9F"
                         Margin="0,0,0,15">
                <ProgressBar.Styles>
                    <Style Selector="ProgressBar">
                        <Setter Property="Background" Value="#2A0F5B"/>
                    </Style>
                </ProgressBar.Styles>
            </ProgressBar>
        </StackPanel>

        <!-- Contacts List with Scroll -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,10,0,0">
            <ItemsControl ItemsSource="{Binding Contacts}">
                <ItemsControl.Styles>
                    <Style Selector="Border.contact-border">
                        <Setter Property="Effect">
                            <DropShadowEffect BlurRadius="0" Color="Transparent" Opacity="0"/>
                        </Setter>
                    </Style>
                    <Style Selector="Border.contact-border:pointerover">
                        <Setter Property="Effect">
                            <DropShadowEffect BlurRadius="20" Color="#5D12D2" Opacity="0.8"/>
                        </Setter>
                    </Style>
                </ItemsControl.Styles>
                
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:Contact">
                        <Border Classes="contact-border"
                                CornerRadius="10"
                                Background="#1E0B45"
                                Margin="0,5"
                                Padding="10"
                                BorderBrush="#5D12D2"
                                BorderThickness="1"
                                Cursor="Hand">
                            <StackPanel Orientation="Horizontal" Spacing="15">
                                <!-- Avatar with glow -->
                                <Border Width="60" Height="60" CornerRadius="30" Background="#2A0F5B"
                                        BorderBrush="#5D12D2" BorderThickness="2">
                                    <Image Source="{Binding AvatarUrl, TargetNullValue='avares://GalaxyMatchGUI/Assets/default-avatar.png'}"
                                           Stretch="UniformToFill">
                                        <Image.Effect>
                                            <DropShadowEffect BlurRadius="8" Color="#5D12D2" Opacity="0.6"/>
                                        </Image.Effect>
                                    </Image>
                                </Border>

                                <!-- Name -->
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="{Binding DisplayName, FallbackValue='Unknown Explorer'}"
                                               FontSize="18"
                                               FontWeight="SemiBold"
                                               Foreground="White"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>